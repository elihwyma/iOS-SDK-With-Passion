/*
 Image: /System/Library/PrivateFrameworks/AppleCVAPhoto.framework/AppleCVAPhoto
 */

#import <AppleCVAPhoto/ImageSaverRegistrator.h>

@class CVAFilterBox, CVAFilterColorAlphaToFgBg, CVAFilterDiffusion, CVAFilterDistanceTransform, CVAFilterGuided, CVAFilterHybridResampling, CVAFilterInfimumConvolution, CVAFilterMaskedVariableBlur, CVAFilterRenderComposite, CVAFilterRenderStagelight, CVAPhotoMTLRingBuffer, MPSImageAreaMin, MPSImageBox, MPSImageGaussianBlur, MPSImageGuidedFilter, NSData, NSObject;

@protocol MTLCommandQueue, MTLComputePipelineState, MTLDeviceSPI, MTLLibrary, MTLResourceGroupSPI, MTLTexture, OS_dispatch_queue, OS_dispatch_semaphore;

@interface VideoMattingMetal : ImageSaverRegistrator

{
    id <MTLDeviceSPI> _device;
    id <MTLLibrary> _defaultLibrary;
    id <MTLCommandQueue> _commandQueue;
    struct CVAPhotoMetalContext *_metalContext;
    _Bool _mattingUsesPostprocessing;
    _Bool _renderingUsesPostprocessing;
    _Bool _enableInfConvolution;
    int _lastCommittedCommand;
    int _width;
    int _height;
    int _width2;
    int _height2;
    float _renderingDisparityBlurRadius;
    float _renderingLensFocalLength_mm;
    _Bool _useTemporalConfidence;
    CVAFilterBox *_boxFilter;
    CVAFilterHybridResampling *_hybridResampler;
    MPSImageGuidedFilter *_guidedFilter;
    CVAFilterGuided *_cvaGuidedFilter;
    CVAFilterRenderStagelight *_stagelightFilter;
    CVAFilterColorAlphaToFgBg *_colorAlphaToFgBg;
    CVAFilterRenderComposite *_renderComposite;
    CVAFilterDistanceTransform *_distanceTransform;
    _Bool _doDisparityDiffusion;
    CVAFilterDiffusion *_diffusion;
    CVAFilterInfimumConvolution *_infConvolution;
    float _infConvolutionScale;
    float _gammaExponent;
    id <MTLComputePipelineState> _diffusionMapKernel;
    id <MTLComputePipelineState> _fillBackgroundDisparityKernel;
    id <MTLComputePipelineState> _fillBackgroundDisparityKernel_faceMask;
    id <MTLComputePipelineState> _disparityConfidenceMaskKernel;
    id <MTLComputePipelineState> _disparityMasksKernel;
    id <MTLComputePipelineState> _disparityIsValidKernel;
    id <MTLComputePipelineState> _domainTransformXKernel;
    id <MTLComputePipelineState> _domainTransformYKernel;
    id <MTLComputePipelineState> _edgeAwareFillXKernel;
    id <MTLComputePipelineState> _edgeAwareFillYKernel;
    id <MTLComputePipelineState> _invalidDisparityMaskKernel;
    id <MTLComputePipelineState> _bgFillXKernel;
    id <MTLComputePipelineState> _bgFillYKernel;
    id <MTLComputePipelineState> _internalDisparityToCanonicalDisparityKernel;
    id <MTLComputePipelineState> _disparityDecimateKernel;
    id <MTLComputePipelineState> _alphaFillKernel;
    id <MTLComputePipelineState> _disparityCleanupKernel;
    id <MTLComputePipelineState> _disparityCleanupKernel_firstFrame;
    id <MTLComputePipelineState> _simpleConfidenceKernel;
    id <MTLComputePipelineState> _updateConfidenceAndLastValidDisparityKernel;
    id <MTLComputePipelineState> _updateConfidenceAndLastValidDisparityKernel_useTemporalConfidence;
    id <MTLComputePipelineState> _roughDisparityKernel;
    id <MTLComputePipelineState> _temporalDisparityFilterKernel;
    id <MTLComputePipelineState> _temporalDisparityFilterKernel_fallbackToInvalid;
    id <MTLComputePipelineState> _renderingDisparityDeweightKernel;
    CVAPhotoMTLRingBuffer *_disparityConfig;
    id <MTLComputePipelineState> _renderingDisparityFillAndFilterKernel;
    struct CompositeConfig _noiseConfig;
    CVAFilterMaskedVariableBlur *_maskedVariableBlur;
    id <MTLComputePipelineState> _halfDownSampler;
    id <MTLComputePipelineState> _colorSimKernel;
    id <MTLComputePipelineState> _colorSimL1Kernel;
    id <MTLComputePipelineState> _temporalCoefficientsFilterKernel;
    id <MTLComputePipelineState> _guidedFilterWeightKernel;
    NSObject<OS_dispatch_semaphore> *_semaphore;
    id <MTLTexture> _rTexture;
    id <MTLTexture> _gTexture;
    id <MTLTexture> _bTexture;
    id <MTLTexture> _bg;
    id <MTLTexture> _blurredBg;
    id <MTLTexture> _deweightedDisparity;
    id <MTLTexture> _shift[2];
    id <MTLTexture> _coc;
    id <MTLTexture> _bgColorLut;
    id <MTLTexture> _fgColorLut;
    id <MTLTexture> _stageLightProxyLut;
    id <MTLTexture> _stageLightLut;
    id <MTLResourceGroupSPI> _backgroundTextureGroup;
    MPSImageBox *_disparityBlurBoxKernel;
    MPSImageBox *_fgBlurBoxKernel;
    MPSImageAreaMin *_fgMaskErosionKernel;
    id <MTLTexture> _gfForegroundMask;
    id <MTLTexture> _gfWeight;
    id <MTLTexture> _disparityLastValidValue[2];
    id <MTLTexture> _disparity[2];
    id <MTLTexture> _facemaskDisparity;
    id <MTLTexture> _filledDisparityTexture;
    id <MTLTexture> _filledDisparityNoInvalidTexture;
    id <MTLTexture> _temporallyFilteredDisparity;
    id <MTLTexture> _disparityConfidenceMaskTexture;
    id <MTLTexture> _smoothConfidence[2];
    id <MTLTexture> _smoothDisparity[2];
    id <MTLTexture> _roughDisparity;
    id <MTLTexture> _diffusionMapTexture;
    id <MTLTexture> _disparityIsValidTexture;
    id <MTLTexture> _distanceFromKnownDisparityTexture;
    id <MTLTexture> _domainTransformXTexture;
    id <MTLTexture> _domainTransformYTexture;
    id <MTLTexture> _edgeAwareFillTempTexture;
    id <MTLTexture> _bgFillTempTexture;
    id <MTLTexture> _invalidDisparityMaskTexture;
    id <MTLTexture> _initDisparity;
    id <MTLTexture> _outputCanonicalDisparity;
    id <MTLTexture> _coeff;
    id <MTLTexture> _coeffHistory[2];
    id <MTLTexture> _isForegroundTexture;
    id <MTLTexture> _distanceToForegroundTexture;
    id <MTLTexture> _alphaNoPostprocessing;
    id <MTLResourceGroupSPI> _alphaNoPostprocessingGroup;
    id <MTLResourceGroupSPI> _edgeAwareGroup;
    id <MTLResourceGroupSPI> _bgFillGroup;
    id <MTLTexture> _scaledSource[2];
    struct __CVBuffer *_scaledSourceCV[2];
    id <MTLTexture> _tempFloatR32FloatTexture;
    struct __CVBuffer *_yuvSourceDownsampledBuffer;
    _Bool _doFaceMask;
    id <MTLTexture> _facemaskRegionTexture;
    unsigned long long _frameIndex;
    MPSImageGaussianBlur *_smoothFilter;
    struct __IOSurfaceAccelerator *_hwScaler;
    id <MTLTexture> _yuvSourceDownsampledTexture;
    NSData *_lastBgLutData;
    NSData *_lastFgLutData;
    NSData *_lastStageLightProxyCubeData;
    NSData *_lastStageLightCubeData;
    NSObject<OS_dispatch_queue> *_synchronousRenderingCallbackQueue;
    NSObject<OS_dispatch_semaphore> *_renderingCallbackSemaphore;
    NSObject<OS_dispatch_queue> *_synchronousMattingCallbackQueue;
    NSObject<OS_dispatch_semaphore> *_mattingCallbackSemaphore;
    struct __sFILE {
        char *_field1;
        int _field2;
        int _field3;
        short _field4;
        short _field5;
        struct __sbuf _field6;
        int _field7;
        void *_field8;
        CDUnknownFunctionPointerType _field9;
        CDUnknownFunctionPointerType _field10;
        CDUnknownFunctionPointerType _field11;
        CDUnknownFunctionPointerType _field12;
        struct __sbuf _field13;
        struct __sFILEX *_field14;
        int _field15;
        unsigned char _field16[3];
        unsigned char _field17[1];
        struct __sbuf _field18;
        int _field19;
        long long _field20;
    } *_scaledSourceFile;
    _Bool _bypassShiftCleanup;
    _Bool _isBgColorLutBlack;
    float _renderingDisparityUpdateRate;
    id <MTLTexture> _colorSim;
    id <MTLTexture> _filteredBeforeSmoothDisparity;
}

@property _Bool isBgColorLutBlack;
@property float renderingDisparityUpdateRate;
@property _Bool bypassShiftCleanup;
@property (readonly) id <MTLTexture> colorSim;
@property (readonly) id <MTLTexture> filteredBeforeSmoothDisparity;

- (void)dealloc;
- (void)initSourceTexture:(struct __CVBuffer *)arg1;
- (id)initWithStaticParams:(const struct VideoMattingStaticParams *)arg1 renderingDisparityUpdateRate:(float)arg2 renderingDisparityBlurRadius:(float)arg3 renderingLensFocalLength_mm:(float)arg4 useTemporalConfidence:(_Bool)arg5 metalContext:(struct CVAPhotoMetalContext *)arg6 error:(id *)arg7;
- (void)prewarmGuidedFilter:(id)arg1 device:(id)arg2 commandBuffer:(id)arg3 width:(int)arg4 height:(int)arg5 width2:(int)arg6 height2:(int)arg7;
- (void)setAlphaLut:(float)arg1 gammaExponent:(float)arg2;
- (void)setBgLut:(id)arg1;
- (void)setFgLut:(id)arg1;
- (void)setPortraitForegroundCubeData:(id)arg1 backgroundCubeData:(id)arg2;
- (void)setStageLightProxyCubeData:(id)arg1 cubeData:(id)arg2;
- (void)encodeCopyTextureToCommandBuffer:(id)arg1 inTexture:(id)arg2 outTexture:(id)arg3;
- (void)encodeColorSimToCommandBuffer:(id)arg1 prevSource:(id)arg2 currSource:(id)arg3 destination:(id)arg4 similarityScaleFactor:(float)arg5;
- (void)encodeColorSimL1ToCommandBuffer:(id)arg1 prevSource:(id)arg2 currSource:(id)arg3 destination:(id)arg4;
- (void)encodeDisparityCleanupToCommandBuffer:(id)arg1 prevDisparity:(id)arg2 currDisparity:(id)arg3 colorSim:(id)arg4 cleanDisparity:(id)arg5;
- (void)encodeDomainTransformToCommandBuffer:(id)arg1 inputDiffusionMap:(id)arg2 inputDistanceFromKnownDisparity:(id)arg3 outputDomainTransformX:(id)arg4 outputDomainTransformY:(id)arg5;
- (void)encodeEdgeAwareFillToCommandBuffer:(id)arg1 inputDisparity:(id)arg2 inputDomainTransformX:(id)arg3 inputDomainTransformY:(id)arg4 outputDisparity:(id)arg5;
- (void)encodeInvalidDisparityMaskToCommandBuffer:(id)arg1 inputDisparity:(id)arg2 outputMask:(id)arg3;
- (void)encodeBackgroundFillToCommandBuffer:(id)arg1 inputDisparity:(id)arg2 inputMask:(id)arg3 outputDisparity:(id)arg4;
- (void)encodeSimpleConfidenceToCommandBuffer:(id)arg1 disparity:(id)arg2 outConfidence:(id)arg3;
- (void)encodeUpdateConfidenceAndLastValidDisparityToCommandBuffer:(id)arg1 disparity:(id)arg2 prevSmoothConfidence:(id)arg3 lastValidDisparityIn:(id)arg4 lastValidDisparityOut:(id)arg5 currConfidenceOut:(id)arg6 useTemporalConfidence:(_Bool)arg7;
- (void)encodeDisparityTemporalFilterToCommandBuffer:(id)arg1 currentDisparity:(id)arg2 previousDisparity:(id)arg3 currConfidence:(id)arg4 prevSmoothConfidence:(id)arg5 colorSim:(id)arg6 outPrevSmoothConfidence:(id)arg7 outTemporallyFilteredDisparity:(id)arg8 disparityFallbackToInvalid:(_Bool)arg9 disparityFilterUpdateRate:(float)arg10 minimumConfidenceToKeepDisparity:(float)arg11 maximumSimilarityToKeepDisparity:(float)arg12;
- (void)encodeDiffusionMapToCommandBuffer:(id)arg1 color:(id)arg2 diffusionMap:(id)arg3;
- (void)encodeDisparityMasksToCommandBuffer:(id)arg1 inputDisparity:(id)arg2 inputSegmentation:(id)arg3 useSegmentationOnly:(_Bool)arg4 outputForegroundMask:(id)arg5 outputIsForeground:(id)arg6 disparityMin:(float)arg7 focusDisparity:(float)arg8 hardness:(float)arg9 minDistToDeweight:(float)arg10 unconfidentWeight:(float)arg11;
- (void)encodeFillBackgroundDisparityToCommandBuffer:(id)arg1 inputDisparity:(id)arg2 inputFacemask:(id)arg3 outputDistanceFromKnownDisparity:(id)arg4 outputDisparity:(id)arg5 backgroundDisparityValue:(float)arg6 minimumDistanceFromValidDisparity:(float)arg7;
- (void)encodeConfidenceMaskToCommandBuffer:(id)arg1 inputDisparity:(id)arg2 inputDisparityNoInvalid:(id)arg3 outputConfidenceMask:(id)arg4;
- (void)encodeOutputDisparityToCommandBuffer:(id)arg1 inputDisparity:(id)arg2 outputDisparity:(id)arg3;
- (id)disparityPostprocessingWithCanonicalDisparity:(struct __CVBuffer *)arg1 color:(struct __CVBuffer *)arg2 postProcessedDisparity:(struct __CVBuffer *)arg3 staticParams:(const struct VideoMattingStaticParams *)arg4 dynamicParams:(const struct VideoMattingDynamicParams *)arg5 postProcessingParams:(const struct VideoPostprocessingParams *)arg6 facesArray:(id)arg7 faceModel:(id)arg8 isFinalStage:(_Bool)arg9 callbackQueue:(id)arg10 callback:(CDUnknownBlockType)arg11;
- (void)alphaMattingWithPostprocessedDisparity:(struct __CVBuffer *)arg1 source:(struct __CVBuffer *)arg2 inSegmentation:(struct __CVBuffer *)arg3 alpha:(struct __CVBuffer *)arg4 staticParams:(const struct VideoMattingStaticParams *)arg5 dynamicParams:(const struct VideoMattingDynamicParams *)arg6 usePostprocessedDisparity:(_Bool)arg7 isFinalStage:(_Bool)arg8 dilateForegroundMask:(_Bool)arg9 callbackQueue:(id)arg10 callback:(CDUnknownBlockType)arg11;
- (void)encodeFilterCoefficientToBuffer:(id)arg1 inputCoeff:(id)arg2 prevCoeff:(id)arg3 outCoeff:(id)arg4 inColorSim:(id)arg5 updateRate:(float)arg6;
- (struct __CVBuffer *)createCVBufferWithWidth:(unsigned long long)arg1 height:(unsigned long long)arg2 format:(unsigned int)arg3;
- (void)encodeScaleSourceToCommandBuffer:(id)arg1 source:(struct __CVBuffer *)arg2 targetWidth:(unsigned long long)arg3 targetHeight:(unsigned long long)arg4;
- (void)encodeGuidedFilterWeightToCommandBuffer:(id)arg1 inputDisparity:(id)arg2 inputSegmentation:(id)arg3 useSegmentationOnly:(_Bool)arg4 inputForegroundDistance:(id)arg5 outputForegroundMask:(id)arg6 outputWeight:(id)arg7 minDistToDeweight:(float)arg8 unconfidentWeight:(float)arg9 dilateForegroundMask:(_Bool)arg10 foregroundMaskDilationRadius:(float)arg11;
- (void)encodeForegroundMaskToBuffer:(id)arg1 disparity:(id)arg2 inSegmentation:(id)arg3 useSegmentationOnly:(_Bool)arg4 weight:(id)arg5 foregroundMask:(id)arg6 erodedForegroundMask:(id)arg7 disparityMin:(float)arg8 focusDisparity:(float)arg9 hardness:(float)arg10 minDistToDeweight:(float)arg11 unconfidentWeight:(float)arg12 dilateForegroundMask:(_Bool)arg13 foregroundMaskDilationRadius:(float)arg14;
- (void)encodeDisparityDecimateToCommandBuffer:(id)arg1 canonicalDisparity:(struct __CVBuffer *)arg2 disparityOut:(id)arg3;
- (pair_879ffb27)blurRadiusAndStdAtInfinityForFocalLength:(float)arg1 focusCanonicalDisparity:(float)arg2 fNumber:(float)arg3 xResolution:(float)arg4 useNewCoCFormula:(_Bool)arg5;
- (void)encodeDisparitySmoothingToCommandBuffer:(id)arg1 disparity:(id)arg2;
- (void)renderContinuousWithSource:(struct __CVBuffer *)arg1 alpha:(struct __CVBuffer *)arg2 canonicalDisparity:(struct __CVBuffer *)arg3 disparityInFocus:(float)arg4 focusCanonicalDisparity:(float)arg5 fNumber:(float)arg6 infConvolutionScale:(float)arg7 noiseBits:(float)arg8 disparityUpdateRate:(float)arg9 focusThresholdHardness:(float)arg10 cubeIntensity:(float)arg11 usePostprocessedDisparity:(_Bool)arg12 dstColor:(struct __CVBuffer *)arg13 isFinalStage:(_Bool)arg14 properties:(id)arg15 callbackQueue:(id)arg16 withCallback:(CDUnknownBlockType)arg17;
- (void)renderStageLightWithSource:(struct __CVBuffer *)arg1 alpha:(struct __CVBuffer *)arg2 canonicalDisparity:(struct __CVBuffer *)arg3 dstColor:(struct __CVBuffer *)arg4 blackBackgroundIntensity:(float)arg5 vignetteIntensity:(float)arg6 isFinalStage:(_Bool)arg7 callbackQueue:(id)arg8 withCallback:(CDUnknownBlockType)arg9;
- (void)encode420HybridDownsamplingToCommandBuffer:(id)arg1 source:(struct __CVBuffer *)arg2 destination:(struct __CVBuffer *)arg3;
- (void)downsampleWithHWScalerSource:(struct __CVBuffer *)arg1 destination:(struct __CVBuffer *)arg2;
- (void)cropFrame:(struct __CVBuffer *)arg1 destination:(struct __CVBuffer *)arg2 rect:(struct CGRect)arg3;
- (void)encode420Bilinear2xDownsamplingToCommandBuffer:(id)arg1 source:(struct __CVBuffer *)arg2 destination:(struct __CVBuffer *)arg3;
- (void)encode420ScalingByMPSToCommandBuffer:(id)arg1 source:(struct __CVBuffer *)arg2 destination:(struct __CVBuffer *)arg3;
- (void)encodeFillAlphaToCommandBuffer:(id)arg1 alpha:(id)arg2;

@end
